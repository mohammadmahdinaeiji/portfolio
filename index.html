<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mohammadmahdi Naeiji | Portfolio</title>
    <meta name="description" content="Mohammadmahdi Naeiji's professional portfolio, showcasing work in Branding, Graphic Design, Typography, and UI/UX design.">
    <meta name="keywords" content="Mohammadmahdi Naeiji, محمدمهدی نائیجی, Graphic Design, Branding, Portfolio, UI/UX, Typography, Iran, Designer">
    <meta name="author" content="Mohammadmahdi Naeiji">
    <meta property="og:title" content="Mohammadmahdi Naeiji | Portfolio">
    <meta property="og:description" content="Professional portfolio of Mohammadmahdi Naeiji in Branding, Graphic Design, and UI/UX.">
    <link rel="canonical" href="[Your-Website-URL]">
    <style>
        /* --- Font Face for Farsi (Local - Peyda) --- */
        @font-face { font-family: 'Peyda'; src: url('fonts/PeydaWebFaNum-Thin.woff2') format('woff2'); font-weight: 100; font-style: normal; }
        @font-face { font-family: 'Peyda'; src: url('fonts/PeydaWebFaNum-Light.woff2') format('woff2'); font-weight: 300; font-style: normal; }
        @font-face { font-family: 'Peyda'; src: url('fonts/PeydaWebFaNum-Regular.woff2') format('woff2'); font-weight: 400; font-style: normal; }
        @font-face { font-family: 'Peyda'; src: url('fonts/PeydaWebFaNum-Medium.woff2') format('woff2'); font-weight: 500; font-style: normal; }
        @font-face { font-family: 'Peyda'; src: url('fonts/PeydaWebFaNum-SemiBold.woff2') format('woff2'); font-weight: 600; font-style: normal; }
        @font-face { font-family: 'Peyda'; src: url('fonts/PeydaWebFaNum-Bold.woff2') format('woff2'); font-weight: 700; font-style: normal; }
        @font-face { font-family: 'Peyda'; src: url('fonts/PeydaWebFaNum-ExtraBold.woff2') format('woff2'); font-weight: 800; font-style: normal; }
        @font-face { font-family: 'Peyda'; src: url('fonts/PeydaWebFaNum-Black.woff2') format('woff2'); font-weight: 900; font-style: normal; }

        /* --- Variables & Color Scheme --- */
        :root {
            --bg-light: #f9f9f9;
            --bg-dark: #1e1e1e; 
            --text-light: #fff;
            --text-dark: #000;
            --accent-base: #1c68a6; 
            --accent-light: #3388c7; 
            --accent-dark: #0b3d68; 
            --accent-dark-end: #0e4e7e; 
            --shadow-color-dark: rgba(0,0,0,0.4);
            --shadow-color-light: rgba(0,0,0,0.15);
        }

        body {
            margin: 0;
            font-family: 'Peyda', Tahoma, sans-serif;
            font-weight: 400; 
            background-color: var(--bg-dark);
            color: var(--text-light);
            scroll-behavior: smooth;
            transition: background-color 0.7s ease, color 0.7s ease;
            line-height: 1.6;
            direction: rtl; 
            text-align: right;
            overflow-x: hidden; 
        }
        
        body.light { background-color: var(--bg-light); color: var(--text-dark); }
        .site-content { opacity: 0; transition: opacity 0.5s; }
        body.loaded .site-content { opacity: 1; }
        
        /* --- Theme-dependent Accent Colors (Gradients) --- */
        body.dark {
            --nav-gradient: linear-gradient(90deg, var(--accent-dark) 0%, var(--accent-dark-end) 100%);
            --current-bg-accent: var(--accent-dark-end);
            --current-shadow: var(--shadow-color-dark);
            --svg-color-filter: brightness(1) invert(0); /* Black SVG on dark BG, remains default */
        }

        body.light {
            --nav-gradient: linear-gradient(90deg, var(--accent-light) 0%, var(--accent-base) 100%);
            --current-bg-accent: var(--accent-base);
            --current-shadow: var(--shadow-color-light);
            --svg-color-filter: brightness(1) invert(0); /* White SVG on light BG, remains default */
        }

        /* RTL/LTR Adjustments */
        html[lang="en"] body { direction: ltr; text-align: left; }
        html[lang="en"] .hero-bio p, html[lang="fa"] .hero-bio p { text-align: justify; }

        /* --- INTRO SCREEN STYLES (Unchanged) --- */
        #intro-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background-color: var(--accent-light); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: transform 0.5s cubic-bezier(0.8, 0.05, 0.2, 1); transform-origin: top; }
        .intro-text { color: var(--text-light); font-family: 'Peyda', sans-serif; font-weight: 700; text-align: center; opacity: 1; transition: opacity 0.3s ease; direction: ltr; }
        .intro-text h1 { font-size: 2.5rem; margin: 0; line-height: 1.1; }
        .intro-text h2 { font-size: 2.5rem; margin: 5px 0 0 0; line-height: 1.1; }
        #intro-screen.fade-out { transform: translateY(100%); }
        .intro-text.hidden { opacity: 0; }

        /* --- General Element Visibility (Unchanged) --- */
        nav, .contact-bar, .theme-toggle { opacity: 0; transition: opacity 0.5s ease, transform 0.5s ease, background 0.7s ease, box-shadow 0.5s ease; }
        .hero-section { opacity: 0; transform: translateY(20px); transition: opacity 0.7s ease, transform 0.7s ease; }
        body.intro-done nav { transition-delay: 0.2s; }
        body.intro-done .contact-bar { transition-delay: 0.3s; }
        body.intro-done .theme-toggle { transition-delay: 0.4s; }
        body.intro-done .hero-section { transition-delay: 0.6s; }
        body.intro-done nav, body.intro-done .contact-bar, body.intro-done .theme-toggle, body.intro-done .hero-section { opacity: 1; transform: none; }
        
        /* --- Navigation (Unchanged) --- */
        nav { background: var(--nav-gradient); position: fixed; top: 0; width: 100%; z-index: 1000; border-radius: 0 0 16px 16px; box-shadow: 0 4px 12px var(--current-shadow); transition: all 0.5s ease, transform 0.3s ease; }
        .nav-controls { display: flex; justify-content: space-between; align-items: center; height: 60px; padding: 0 40px; color: var(--text-light); font-weight: 700; direction: ltr; }
        .nav-header-new { margin-right: auto; margin-left: 0; order: 1; }
        .lang-toggle { margin-left: auto; margin-right: 0; order: 2; }
        .nav-header-new { display: flex; flex-direction: row; align-items: center; color: var(--text-light); padding: 5px 0; cursor: pointer; }
        .nav-header-text { display: flex; flex-direction: column; align-items: flex-start; order: 2; }
        .nav-header-new .main-title { font-weight: 700; font-size: 1.1rem; line-height: 1.2; }
        .nav-header-new .sub-title { font-weight: 300; font-size: 0.8rem; opacity: 0.8; }
        .nav-header-new .arrow { display: inline-block; width: 10px; height: 10px; border: solid var(--text-light); border-width: 0 2px 2px 0; transform: rotate(45deg); transition: transform 0.3s ease; margin-left: 10px; order: 1; }
        .lang-toggle { display: flex; gap: 5px; padding: 5px 0; direction: ltr; }
        .lang-toggle button { background: none; border: none; padding: 0 5px; cursor: pointer; opacity: 0.8; transition: opacity 0.3s ease; display: flex; align-items: center; color: var(--text-light); font-size: 0.9rem; font-weight: 300; }
        .lang-toggle button.active { opacity: 1; text-decoration: underline; font-weight: 500; }
        /* پرچم‌ها نیازی به فیلتر رنگ ندارند */
        .lang-toggle img { width: 20px; height: 20px; border-radius: 2px; margin-right: 3px; margin-left: 0; }
        
        .nav-links { display: flex; justify-content: center; gap: 35px; padding: 10px 10px; align-items: center; flex-wrap: wrap; transition: max-height 0.4s ease-out, opacity 0.4s ease-out, padding 0.4s ease-out; max-height: 0; opacity: 0; overflow: hidden; }
        nav a { color: var(--text-light); text-decoration: none; font-weight: 400; white-space: nowrap; padding: 5px 10px; border-radius: 5px; transition: all 0.3s ease; }
        nav a:hover { font-weight: 600; background-color: rgba(255, 255, 255, 0.1); }
        nav.expanded .nav-links { max-height: 500px; opacity: 1; padding: 10px 10px 15px; }
        nav.expanded .nav-header-new .arrow { transform: rotate(135deg); }
        nav:not(.expanded).scrolled { transform: translateY(-100%); }
        
        /* Hero, Gallery, Frames (Unchanged structure) */
        .hero-section { padding-top: 80px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; min-height: 50vh; padding-bottom: 50px; }
        .hero-avatar { width: 150px; height: 150px; border-radius: 50%; overflow: hidden; margin-bottom: 20px; border: 5px solid var(--current-bg-accent); box-shadow: 0 0 0 8px rgba(255, 255, 255, 0.1); transition: border 0.5s ease; }
        .hero-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .hero-title h1 { font-size: 2.5rem; font-weight: 800; margin: 0 0 5px 0; }
        .hero-title h2 { font-size: 1.2rem; font-weight: 300; margin: 0 0 30px 0; opacity: 0.8; }
        .hero-bio { max-width: 700px; margin: 20px auto 40px; padding: 0 20px; font-size: 1.1rem; font-weight: 300; }
        .hero-bio p { margin: 0; padding: 0; }
        .hero-actions a { text-decoration: none; padding: 12px 30px; border-radius: 50px; font-weight: 600; transition: all 0.3s ease; white-space: nowrap; display: inline-flex; align-items: center; }
        .hero-primary-btn { background: var(--current-bg-accent); color: var(--text-light); border: 2px solid var(--current-bg-accent); }
        .hero-primary-btn:hover { background: none; color: var(--current-bg-accent); }
        .gallery { margin-top: 50px; display: flex; flex-direction: column; align-items: center; gap: 60px; padding: 0 5vw 100px; }
        .project-section { width: 100%; max-width: 1100px; scroll-margin-top: 100px; }
        .frame { 
            width: 100%; max-width: 900px; aspect-ratio: 297/210; border-radius: 0; overflow: hidden; 
            background: #2a2a2a; box-shadow: 0 8px 25px var(--current-shadow); margin: 0 auto 30px; 
            transition: transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.7s ease;
            scroll-margin-top: 80px; opacity: 0.5; transform: scale(0.95);
        }
        /* **حذف کلاس in-view از HTML و مدیریت آن با JS** */
        .frame.in-view { transform: scale(1.0); opacity: 1; }
        .frame img { 
            width: 100%; height: 100%; object-fit: cover; display: block; direction: ltr; 
        }
        
        /* Toggle/Button (Theme, Scroll) */
        .theme-toggle, .scroll-btn { 
            position: fixed; bottom: 20px; width: 48px; height: 48px; border-radius: 50%; 
            background: var(--current-bg-accent); border: none; cursor: pointer; display: flex; 
            justify-content: center; align-items: center; z-index: 1500; 
            box-shadow: 0 4px 8px var(--current-shadow); transition: all 0.3s ease, background 0.5s ease;
        }
        .theme-toggle { right: 20px; }
        .scroll-btn { right: 80px; }
        
        /* **تغییر آیکون‌های SVG (ماه/خورشید و فلش بالا)** */
        .theme-toggle img, .scroll-btn img { 
            width: 60%; height: 60%; object-fit: contain; 
            /* فیلتر برای اطمینان از رنگ سفید آیکون‌های SVG روی دکمه‌های آکسنت */
            transition: all 0.3s ease; 
        }
        .theme-toggle:hover, .scroll-btn:hover { transform: scale(1.1); }

        /* --- Contact Bar --- */
        .contact-bar { 
            position: fixed; left: 0; top: 50%; transform: translateY(-50%); display: flex; 
            flex-direction: column; align-items: center; z-index: 1000; 
            background: var(--nav-gradient); border-radius: 0 16px 16px 0; padding: 10px 5px; 
            width: 50px; height: 70px; overflow: hidden; cursor: pointer; 
            box-shadow: 4px 0 12px var(--current-shadow); 
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), background 0.7s ease, transform 0.3s ease;
        }
        
        .contact-bar.active { transform: translateY(-50%) translateX(15px); height: 200px; }

        .contact-bar-label { position: static; transform: none; margin-bottom: 5px; writing-mode: horizontal-tb; width: auto; padding-top: 5px; opacity: 1; text-align: center; color: var(--text-light); font-size: 14px; font-weight: 500; transition: all 0.4s ease; }
        .contact-icons { display: flex; flex-direction: column; align-items: center; opacity: 0; max-height: 0; margin-top: 0; transition: max-height 0.4s ease, opacity 0.4s ease, margin-top 0.4s ease; }
        .contact-icons a { margin: 5px 0; }
        
        /* **تغییر آیکون‌های SVG شبکه‌های اجتماعی** */
        .contact-icons img { 
            width: 32px; height: 32px; margin: 0; 
            /* فیلتر برای اطمینان از رنگ سفید آیکون‌های SVG شبکه‌های اجتماعی */
            transition: all 0.3s ease; 
        }
        
        /* Desktop Hover/Active (Unchanged) */
        @media (min-width: 769px) { 
            .contact-bar:hover, .contact-bar.active { height: 200px; transform: translateY(-50%) translateX(15px); } 
            .contact-bar:hover .contact-bar-label, .contact-bar.active .contact-bar-label { margin-bottom: 10px; } 
            .contact-bar:hover .contact-icons, .contact-bar.active .contact-icons { opacity: 1; max-height: 150px; } 
        }

        /* Responsive (Mobile) (Unchanged) */
        @media (max-width: 768px) {
            .nav-controls { height: 50px; padding: 0 15px; }
            .hero-section { padding-top: 70px; }
            .gallery { padding-bottom: 90px; }
            .frame { border-radius: 0; } 
            .contact-bar { left: 50%; bottom: 0; top: auto; transform: translateX(-50%); width: 90vw; height: 60px; border-radius: 16px 16px 0 0; padding: 0 10px; justify-content: space-around; box-shadow: 0 -4px 12px var(--current-shadow); background: var(--nav-gradient); flex-direction: row; cursor: default; min-width: auto; }
            .contact-bar-label { display: none; }
            .contact-icons { opacity: 1; max-height: none; max-width: 100%; gap: 15px; justify-content: center; margin: 0; flex-direction: row; }
            .contact-icons a { margin: 0; }
            .contact-icons img { width: 38px; height: 38px; margin: 0; }
            .theme-toggle, .scroll-btn { bottom: 80px; }
            .site-footer { padding-bottom: 70px; }
            .intro-text h1, .intro-text h2 { font-size: 1.8rem; }
        }

        /* Footer (Unchanged) */
        .site-footer { text-align: center; padding: 20px 0 40px; font-size: 0.85rem; opacity: 0.7; transition: color 0.7s ease; }
    </style>
</head>
<body class="light">

    <div id="intro-screen">
        <div class="intro-text" id="introText">
            <h1>Mohammadmahdi Naeiji</h1>
            <h2>Portfolio</h2>
        </div>
    </div>
    
    <div class="site-content">
        <nav id="mainNav">
            <div class="nav-controls" id="navControls">
                <div class="nav-header-new" id="navHeaderNew">
                    <span class="nav-header-text">
                        <span class="main-title" data-en="Portfolio" data-fa="Portfolio">Portfolio</span>
                        <span class="sub-title" data-en="Mohammadmahdi Naeiji" data-fa="محمدمهدی نائیجی">Mohammadmahdi Naeiji</span>
                    </span>
                    <span class="arrow"></span>
                </div>
                <div class="lang-toggle" id="langToggle">
                    <button data-lang="en" class="active"><img src="images/gb.svg" alt="English Flag">EN</button>
                    <button data-lang="fa"><img src="images/ir.svg" alt="Farsi Flag">FA</button>
                </div>
            </div>
            <div class="nav-links" id="navLinks">
                <a href="#about" data-en="About" data-fa="درباره" class="nav-link-item">About</a>
                <a href="#projects" data-en="Table of Contest" data-fa="فهرست مطالب" class="nav-link-item">Projects</a>
                <a href="#caravan" data-en="Caravan Brand" data-fa="برند کاروان" class="nav-link-item">Caravan Brand</a>
                <a href="#hoveid" data-en="Hoveid Brand" data-fa="برند هوید" class="nav-link-item">Hoveid Brand</a>
                <a href="#aftabe" data-en="Aftabe Dozd" data-fa="بازی آفتابه دزد" class="nav-link-item">Aftabe Dozd Board Game</a>
                <a href="#ai_i" data-en="AI & I" data-fa="هوش مصنوعی و من" class="nav-link-item">AI & I</a>
                <a href="#book" data-en="Book Cover" data-fa="جلد کتاب و لی‌اوت" class="nav-link-item">Book Cover & Layout</a>
                <a href="#typography" data-en="Typography" data-fa="تایپوگرافی" class="nav-link-item">Typography</a>
            </div>
        </nav>
        <section class="hero-section">
            <div class="hero-avatar">
                <img src="images/me.svg" alt="Mohammadmahdi Naeiji">
            </div>
            <div class="hero-title">
                <h1 data-en="Mohammadmahdi Naeiji" data-fa="محمدمهدی نائیجی">Mohammadmahdi Naeiji</h1>
                <h2 data-en="Graphic Design Student, Illustrator & AI Storyteller" data-fa="دانشجوی طراحی گرافیک، تصویرگر و قصه‌گوی بصری با هوش مصنوعی">Graphic Design Student, Illustrator & AI Storyteller</h2>
            </div>
            <div class="hero-bio">
                <p data-en="I’m a passionate Graphic Design student exploring the intersection of art, technology, and creativity. With a strong foundation in visual storytelling, I’m particularly interested in how artificial intelligence can inspire new forms of visual expression. My creative process blends experimentation, research, and storytelling—aiming to create visuals that are both beautiful and meaningful. I am always eager to learn, collaborate, and grow through new projects and experiences." data-fa="من یک دانشجوی طراحی گرافیک هستم و به دنبال تلاقی هنر، تکنولوژی و خلاقیت می‌باشم. با داشتن پایه قوی در داستان‌گویی بصری، به ویژه علاقه‌مندم به اینکه چگونه هوش مصنوعی می‌تواند الهام‌بخش اشکال جدیدی از بیان بصری باشد. فرآیند خلاقیت من ترکیبی از آزمایش، تحقیق و قصه‌گویی است و هدفم خلق تصاویری است که هم زیبا و هم معنادار باشند. من همیشه مشتاق یادگیری، همکاری و رشد از طریق پروژه‌ها و تجربیات جدید هستم."> I’m a passionate Graphic Design student exploring the intersection of art, technology, and creativity. With a strong foundation in visual storytelling, I’m particularly interested in how artificial intelligence can inspire new forms of visual expression. My creative process blends experimentation, research, and storytelling—aiming to create visuals that are both beautiful and meaningful. I am always eager to learn, collaborate, and grow through new projects and experiences. </p>
            </div>
            <div class="hero-actions">
                <a href="https://www.linkedin.com/in/mohammad-mahdi-naeiji/" target="_blank" class="hero-primary-btn" data-en="View on LinkedIn" data-fa="مشاهده در لینکدین">View on LinkedIn</a>
            </div>
        </section>
        <div class="gallery" id="gallery">
            <div class="project-section" id="about"></div>
            <div class="project-section" id="projects"></div>
            <div class="project-section" id="caravan"></div>
            <div class="project-section" id="hoveid"></div>
            <div class="project-section" id="aftabe"></div>
            <div class="project-section" id="ai_i"></div>
            <div class="project-section" id="book"></div>
            <div class="project-section" id="typography"></div>
        </div>
        <div class="contact-bar" id="contactBar">
            <span class="contact-bar-label" data-en="Contact" data-fa="تماس">Contact</span>
            <div class="contact-icons">
                <a href="https://www.linkedin.com/in/mohammad-mahdi-naeiji/" target="_blank"><img src="images/linkedin.svg" alt="LinkedIn"></a>
                <a href="https://www.instagram.com/mohammadmahdi_naeiji/" target="_blank"><img src="images/instagram.svg" alt="Instagram"></a>
                <a href="https://www.behance.net/mohammadmahdi_naeiji" target="_blank"><img src="images/behance.svg" alt="Behance"></a>
            </div>
        </div>
        <button class="theme-toggle">
            <img src="images/sun.svg" alt="Sun icon for Light Mode" id="themeIcon">
        </button>
        <button class="scroll-btn" id="scrollToTopBtn" style="display: none;">
            <img src="images/up-arrow.svg" alt="Up Arrow">
        </button>
        <div class="site-footer">
            <p data-en="&copy; 2025 Mohammadmahdi Naeiji. All rights reserved." data-fa="&copy; ۱۴۰۴ محمدمهدی نائیجی. کلیه حقوق محفوظ است.">&copy; 2025 Mohammadmahdi Naeiji. All rights reserved.</p>
        </div>
    </div>
    
    <script>
        // --- Gallery Creation (Inject Missing Frames) ---
        const totalFrames = 46;
        const imgPrefix = "images/page_";
        // **تغییر پسوند تصاویر**
        const ext = "webp"; 
        const getSection = (id) => document.getElementById(id);

        const projectSections = [
            // **اضافه شدن بخش 'about' به صورت دستی برای صفحه 2 و 3**
            { id: "about", start: 2, end: 3 }, 
            // **اضافه شدن بخش 'projects' به صورت دستی برای صفحه 4**
            { id: "projects", start: 4, end: 4 },
            // **اضافه شدن بخش 'caravan' به صورت دستی برای صفحه 5**
            { id: "caravan", start: 5, end: 5 }, 
            { id: "caravan", start: 6, end: 15 }, 
            { id: "hoveid", start: 17, end: 24 }, 
            { id: "aftabe", start: 26, end: 28 },
            { id: "ai_i", start: 30, end: 36 },
            { id: "book", start: 38, end: 41 },
            { id: "typography", start: 43, end: 46 }
        ];

        // **تعیین فریم‌های ابتدایی که باید بلافاصله بارگذاری شوند (بدون انیمیشن اولیه)**
        const initialOpenFrames = [2, 3, 4, 5]; 

        function injectFrames() {
             projectSections.forEach(sectionInfo => {
                const sectionElement = getSection(sectionInfo.id);
                if (sectionElement) {
                    for (let i = sectionInfo.start; i <= sectionInfo.end; i++) {
                        const frame = document.createElement("div");
                        frame.className = "frame";
                        frame.id = `page${i}`; 
                        
                        // **اعمال کلاس 'in-view' برای فریم‌های اولیه**
                        if (initialOpenFrames.includes(i)) {
                            frame.classList.add("in-view");
                        }
                        
                        const img = document.createElement("img");
                        // **استفاده از پسوند جدید**
                        img.src = `${imgPrefix}${i}.${ext}`; 
                        img.alt = `page ${i}`; 
                        
                        frame.appendChild(img);
                        sectionElement.appendChild(frame);
                    }
                }
            });
            window.allFrames = document.querySelectorAll(".frame");
        }


        // --- Intro Logic (Unchanged) ---
        const introScreen = document.getElementById('intro-screen');
        const introText = document.getElementById('introText');
        const siteBody = document.body;
        
        function startIntro() {
            const fadeOutDuration = 300; 
            const slideDownDuration = 500; 
            
            setTimeout(() => {
                introText.classList.add('hidden');
            }, fadeOutDuration); 

            setTimeout(() => {
                introScreen.classList.add('fade-out');
            }, fadeOutDuration + 50); 

            setTimeout(() => {
                siteBody.classList.add('intro-done');
            }, fadeOutDuration + slideDownDuration); 

            setTimeout(() => {
                introScreen.style.display = 'none';
                siteBody.classList.add('loaded');
                checkInView();
                window.addEventListener("scroll", handleNavScroll); 
                window.addEventListener("scroll", checkInView);
            }, fadeOutDuration + slideDownDuration + 500); 
        }
        
        // --- Preload/Initial Load ---
        window.addEventListener('load', () => {
             injectFrames(); 
             startIntro();
             setInitialThemeAndLang(); 
        });
        
        // --- Language Toggler (Unchanged) ---
        const langToggle = document.getElementById('langToggle');
        const langButtons = langToggle.querySelectorAll('button');
        const translatableElements = document.querySelectorAll('[data-en], [data-fa]');

        function setLanguage(lang) {
            document.documentElement.lang = lang;
            translatableElements.forEach(el => {
                const text = el.getAttribute(`data-${lang}`);
                if (text) {
                    if (el.tagName !== 'A' && el.tagName !== 'SPAN') {
                        el.textContent = text;
                    } else {
                        el.textContent = text;
                    }
                }
            });
            langButtons.forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
            });
            localStorage.setItem('lang', lang);
        }

        langButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation(); 
                const lang = btn.getAttribute('data-lang');
                setLanguage(lang);
            });
        });

        function setInitialThemeAndLang() {
            const defaultLang = localStorage.getItem('lang') || 'en';
            setLanguage(defaultLang);
            
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                updateTheme(savedTheme === 'dark');
            } else {
                updateTheme(false); 
            }
        }
        
        // --- Theme Toggle ---
        const themeBtn = document.querySelector(".theme-toggle");
        const themeIcon = document.getElementById("themeIcon");

        function updateTheme(isDark) {
            document.body.classList.toggle("dark", isDark);
            document.body.classList.toggle("light", !isDark);
            // **استفاده از پسوند SVG**
            themeIcon.src = isDark ? "images/sun.svg" : "images/moon.svg";
            themeIcon.alt = isDark ? "Sun icon for Light Mode" : "Moon icon for Dark Mode";
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        themeBtn.addEventListener("click", () => {
            const isDark = document.body.classList.contains("dark");
            updateTheme(!isDark);
        });

        // --- Collapsible Navigation on Scroll Logic (Unchanged) ---
        const mainNav = document.getElementById('mainNav');
        const navHeaderNew = document.getElementById('navHeaderNew');
        const navLinks = document.querySelectorAll('.nav-link-item');
        const scrollThreshold = 100;
        let lastScrollTop = 0;

        function collapseNav() { mainNav.classList.remove('expanded'); }
        function expandNav() {
            const isCollapsedByScroll = window.scrollY > scrollThreshold;
            mainNav.classList.add('expanded');
            if (!isCollapsedByScroll) { window.scrollTo({ top: scrollThreshold + 1, behavior: 'smooth' }); }
        }

        function handleNavScroll() {
            const currentScroll = window.scrollY;
            const isExpanded = mainNav.classList.contains('expanded');

            if (!isExpanded) {
                if (currentScroll < lastScrollTop && currentScroll > scrollThreshold) {
                    mainNav.classList.remove('scrolled'); 
                } 
                else if (currentScroll > lastScrollTop && currentScroll > scrollThreshold * 1.5) {
                    mainNav.classList.add('scrolled'); 
                }
            } 
            
            if (currentScroll < scrollThreshold) {
                 mainNav.classList.remove('scrolled');
            }

            lastScrollTop = currentScroll <= 0 ? 0 : currentScroll; 
        }

        navHeaderNew.addEventListener('click', () => {
            if (mainNav.classList.contains('expanded')) { collapseNav(); } 
            else { expandNav(); }
        });

        navLinks.forEach(link => link.addEventListener('click', () => setTimeout(collapseNav, 500)));


        // --- Frame Scroll Effect (Logic changed to treat all frames uniformly after initial load) ---
        function checkInView() {
            const windowHeight = window.innerHeight;
            if(!window.allFrames) return; 

            window.allFrames.forEach(f => {
                const rect = f.getBoundingClientRect();
                const isVisible = (rect.top < windowHeight * 0.85) && (rect.bottom > windowHeight * 0.15);

                // **اعمال lazy loading به تمام فریم‌هایی که در ابتدای کار in-view نشده‌اند**
                // اگر فریم در ویوپورت دیده شد، کلاس in-view را اضافه کن.
                f.classList.toggle('in-view', isVisible);
            });
        }
        
        // --- Scroll To Top (Unchanged) ---
        const scrollToTopBtn = document.getElementById("scrollToTopBtn");

        window.addEventListener("scroll", () => {
            scrollToTopBtn.style.display = window.scrollY > 400 ? "flex" : "none";
        });

        scrollToTopBtn.addEventListener("click", () => window.scrollTo({ top: 0, behavior: "smooth" }));

        // --- Contact Bar Interaction (Unchanged) ---
        const contactBar = document.getElementById("contactBar");

        if (window.innerWidth > 768) {
            contactBar.addEventListener("mouseenter", () => { contactBar.classList.add("active"); });
            contactBar.addEventListener("mouseleave", () => { contactBar.classList.remove("active"); });
        } 
        else {
            contactBar.addEventListener("click", (e) => {
                e.preventDefault(); 
                contactBar.classList.toggle("active");
            });
        }
    </script>
</body>
</html>

