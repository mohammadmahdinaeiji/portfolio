name: Generate Sitemap

on:
  push:
    branches:
      - main
  workflow_dispatch: # امکان اجرای دستی

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Generate sitemap.xml
        run: |
          TODAY=$(date +"%Y-%m-%d")
          cat <<EOF > sitemap.xml
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <url>
    <loc>https://mohammadmahdinaeiji.github.io/portfolio/</loc>
    <lastmod>$TODAY</lastmod>
    <priority>1.0</priority>
  </url>
  <url>
    <loc>https://mohammadmahdinaeiji.github.io/portfolio/about.html</loc>
    <lastmod>$TODAY</lastmod>
    <priority>0.8</priority>
  </url>
  <url>
    <loc>https://mohammadmahdinaeiji.github.io/portfolio/projects.html</loc>
    <lastmod>$TODAY</lastmod>
    <priority>0.8</priority>
  </url>
  <url>
    <loc>https://mohammadmahdinaeiji.github.io/portfolio/contact.html</loc>
    <lastmod>$TODAY</lastmod>
    <priority>0.6</priority>
  </url>
</urlset>
EOF

      - name: Commit and push sitemap
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add sitemap.xml
          git commit -m "Update sitemap.xml"
          git push || echo "No changes to commit"
